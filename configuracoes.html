<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <title>Configurações - IrrigaSeca</title>
    <style>
        /* Adicionando CSS para botões de controle manual */
        .manual-control { margin-bottom: 30px; padding: 20px; background: #fff3e0; border: 1px solid #ffcc80; border-radius: 6px; }
        .manual-control h3 { color: #e65100; border-bottom: none; }
        .rele-buttons { display: flex; flex-wrap: wrap; gap: 15px; }
        .rele-buttons button { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; transition: background-color 0.2s; flex: 1 1 180px; }
        .btn-on { background-color: #d9534f; color: white; }
        .btn-off { background-color: #5cb85c; color: white; }
        .btn-on:hover { background-color: #c9302c; }
        .btn-off:hover { background-color: #4cae4c; }
        /* ... (Restante do CSS) ... */
    </style>
</head>
<body>
    <div class="container">
        <h2>Painel de Configurações</h2>

        <div class="manual-control">
            <h3>Controle Manual dos Relés (Override)</h3>
            <p>O controle manual sobrepõe a lógica automática até a próxima reinicialização ou intervenção do firmware.</p>
            <div class="rele-buttons">
                <button class="btn-on" onclick="controlRele('A', 'ON')">Fileira A - LIGAR</button>
                <button class="btn-off" onclick="controlRele('A', 'OFF')">Fileira A - DESLIGAR</button>
                
                <button class="btn-on" onclick="controlRele('B', 'ON')">Fileira B - LIGAR</button>
                <button class="btn-off" onclick="controlRele('B', 'OFF')">Fileira B - DESLIGAR</button>

                <button class="btn-on" onclick="controlRele('C', 'ON')">Fileira C - LIGAR</button>
                <button class="btn-off" onclick="controlRele('C', 'OFF')">Fileira C - DESLIGAR</button>

                <button class="btn-on" onclick="controlRele('D', 'ON')">Fileira D - LIGAR</button>
                <button class="btn-off" onclick="controlRele('D', 'OFF')">Fileira D - DESLIGAR</button>
            </div>
        </div>
        
        <form id="config-form">
            <div class="config-group">
                <h3>Configuração por Fileira (Fileira A - Argiloso)</h3>
                <div class="input-pair">
                    <div>
                        <label for="fileiraA-ligar">PMP (Ligar em %)</label>
                        <input type="number" id="fileiraA-ligar" name="fileiraA-ligar" value="15" min="0" max="100" step="0.5" required>
                    </div>
                    <div>
                        <label for="fileiraA-desligar">CC (Desligar em %)</label>
                        <input type="number" id="fileiraA-desligar" name="fileiraA-desligar" value="40" min="0" max="100" step="0.5" required>
                    </div>
                </div>
            </div>

            <div class="config-group">
                <h3>Configuração por Fileira (Fileira B - Arenoso)</h3>
                <div class="input-pair">
                    <div>
                        <label for="fileiraB-ligar">PMP (Ligar em %)</label>
                        <input type="number" id="fileiraB-ligar" name="fileiraB-ligar" value="15" min="0" max="100" step="0.5" required>
                    </div>
                    <div>
                        <label for="fileiraB-desligar">CC (Desligar em %)</label>
                        <input type="number" id="fileiraB-desligar" name="fileiraB-desligar" value="30" min="0" max="100" step="0.5" required>
                    </div>
                </div>
            </div>

            <div class="config-group">
                <h3>Configuração por Fileira (Fileira C - Média)</h3>
                <div class="input-pair">
                    <div>
                        <label for="fileiraC-ligar">PMP (Ligar em %)</label>
                        <input type="number" id="fileiraC-ligar" name="fileiraC-ligar" value="16" min="0" max="100" step="0.5" required>
                    </div>
                    <div>
                        <label for="fileiraC-desligar">CC (Desligar em %)</label>
                        <input type="number" id="fileiraC-desligar" name="fileiraC-desligar" value="32" min="0" max="100" step="0.5" required>
                    </div>
                </div>
            </div>

            <div class="config-group">
                <h3>Configuração por Fileira (Fileira D - Arenoso Fino)</h3>
                <div class="input-pair">
                    <div>
                        <label for="fileiraD-ligar">PMP (Ligar em %)</label>
                        <input type="number" id="fileiraD-ligar" name="fileiraD-ligar" value="17" min="0" max="100" step="0.5" required>
                    </div>
                    <div>
                        <label for="fileiraD-desligar">CC (Desligar em %)</label>
                        <input type="number" id="fileiraD-desligar" name="fileiraD-desligar" value="28" min="0" max="100" step="0.5" required>
                    </div>
                </div>
            </div>

            <button type="submit">Salvar Configurações (Lógica Automática)</button>
            <a href="index.html" style="display: block; margin-top: 15px; text-align: center; color: #007bff; text-decoration: none;">Voltar para Dashboard</a>
        </form>

        </div>

    <script>
        // Função para simular o controle manual
        function controlRele(fileira, estado) {
            alert(`COMANDO ENVIADO: Fileira ${fileira} - ${estado}. (Isso enviaria uma chamada API para o ESP32)`);
            console.log(`Manual Override: Rele ${fileira} set to ${estado}`);
            // No projeto real, faria um fetch/POST para um endpoint como /api/rele/A?action=ON
        }

        // Função para salvar as configurações automáticas (AGORA COM C e D)
        document.getElementById('config-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const form = e.target;
            const configs = {
                "default_ativacao": parseFloat(form.elements['default-ativacao'].value),
                "default_desativacao": parseFloat(form.elements['default-desativacao'].value),
                "hora_inicio_noturna": parseFloat(form.elements['hora-inicio-noturna'].value),
                "hora_fim_noturna": parseFloat(form.elements['hora-fim-noturna'].value),
                "umidade_emergencia": parseFloat(form.elements['umidade-emergencia'].value),
                "fileiras": {
                    "fileiraA": { "reles": [{ "id": "sensor_principal", "ligar_em": parseFloat(form.elements['fileiraA-ligar'].value), "desligar_em": parseFloat(form.elements['fileiraA-desligar'].value) }] },
                    "fileiraB": { "reles": [{ "id": "sensor_principal", "ligar_em": parseFloat(form.elements['fileiraB-ligar'].value), "desligar_em": parseFloat(form.elements['fileiraB-desligar'].value) }] },
                    "fileiraC": { "reles": [{ "id": "sensor_principal", "ligar_em": parseFloat(form.elements['fileiraC-ligar'].value), "desligar_em": parseFloat(form.elements['fileiraC-desligar'].value) }] },
                    "fileiraD": { "reles": [{ "id": "sensor_principal", "ligar_em": parseFloat(form.elements['fileiraD-ligar'].value), "desligar_em": parseFloat(form.elements['fileiraD-desligar'].value) }] }
                }
            };
            
            console.log('Novas Configurações Salvas (Lógica Automática):', configs);
            alert('Configurações salvas (mock). O ESP32 seria atualizado via API.');
            // No projeto real, faria um fetch/POST para o endpoint de configuração
        });
        
        // Função para carregar valores default (para simulação)
        document.addEventListener('DOMContentLoaded', () => {
             // Mock de carregamento dos valores globais se existissem
             document.getElementById('default-ativacao').value = 18;
             document.getElementById('default-desativacao').value = 25;
             document.getElementById('hora-inicio-noturna').value = 1;
             document.getElementById('hora-fim-noturna').value = 5;
             document.getElementById('umidade-emergencia').value = 10;
        });

    </script>
</body>
</html>